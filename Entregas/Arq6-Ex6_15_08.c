// MICAP T01 2023/2
// Arq6-Ex6 (15/08/2023)
// Escrito por Isadora S. Silva e Mateus B. Cassiano

#include "def_pinos.h"
#include "config.c"

__code unsigned char caract[44][4] = {{0xff, 0x81, 0x81, 0xff},  // 0
									  {0x84, 0x82, 0xff, 0x80},  // 1
									  {0xc6, 0xa1, 0x91, 0x8e},  // 2
									  {0x42, 0x99, 0x99, 0x66},  // 3
									  {0x1f, 0x10, 0x10, 0xff},  // 4
									  {0x8e, 0x89, 0x89, 0x79},  // 5
									  {0x7e, 0x89, 0x89, 0x79},  // 6
									  {0xc1, 0x31, 0x19, 0x0f},  // 7
									  {0x66, 0x99, 0x99, 0x66},  // 8
									  {0x4e, 0x91, 0x91, 0x7e},  // 9

									  {0x00, 0x66, 0x66, 0x00},  // :
									  {0x00, 0x46, 0x26, 0x00},  // ;
									  {0x18, 0x24, 0x42, 0x81},  // <
									  {0x66, 0x66, 0x66, 0x66},  // =
									  {0x81, 0x42, 0x24, 0x18},  // >
									  {0x06, 0xa1, 0x11, 0x0e},  // ?
									  {0x7e, 0x9d, 0xa3, 0x3e},  // @

									  {0xfe, 0x11, 0x11, 0xfe},  // A
									  {0xff, 0x99, 0x99, 0x66},  // B
									  {0x7e, 0x81, 0x81, 0x81},  // C
									  {0xff, 0x81, 0x81, 0x7e},  // D
									  {0xff, 0x99, 0x99, 0x99},  // E
									  {0xff, 0x19, 0x19, 0x19},  // F
									  {0x7e, 0x81, 0x91, 0x72},  // G
									  {0xff, 0x18, 0x18, 0xff},  // H
									  {0x81, 0xff, 0xff, 0x81},  // I
									  {0xe1, 0x81, 0xff, 0x01},  // J
									  {0xff, 0x18, 0x36, 0xc1},  // K
									  {0xff, 0xc0, 0xc0, 0xc0},  // L
									  {0xff, 0x0e, 0x0e, 0xff},  // M
									  {0xff, 0x0c, 0x30, 0xff},  // N
									  {0x7e, 0x81, 0x81, 0x7e},  // O
									  {0xfe, 0x11, 0x11, 0x0e},  // P
									  {0x3e, 0x41, 0x41, 0xbe},  // Q
									  {0xff, 0x11, 0x31, 0xce},  // R
									  {0x8e, 0x99, 0x99, 0x71},  // S
									  {0x03, 0xff, 0xff, 0x03},  // T
									  {0x7f, 0xc0, 0xc0, 0x7f},  // U
									  {0x3f, 0xc0, 0xc0, 0x3f},  // V
									  {0xff, 0x70, 0x70, 0xff},  // W
									  {0xe7, 0x18, 0x18, 0xe7},  // X
									  {0x0f, 0xf0, 0xf0, 0x0f},  // Y
									  {0xc1, 0xb1, 0x99, 0x87},  // Z

									  {0x00, 0x00, 0x00, 0x00}}; // <espaÃ§o>

__xdata unsigned char string[128] = {0};

void delay_ms (unsigned int t) {
	TMOD |=  0x01;
	TMOD &= ~0x02;

	for(; t>0; t--) {
		TR0 = 0;
		TF0 = 0;
		TL0 = 0x58;
		TH0 = 0x9E;

		TR0 = 1;
		while(TF0 == 0);
	}
}

void mostra_car(unsigned char lin) {

	P0 = caract[lin][0];
	P1 = caract[lin][1];
	P2 = caract[lin][2];
	P3 = caract[lin][3];
}

void mostra_car2(unsigned char c) {
	if (c >= 48 && c <= 90)
		mostra_car(c - 48);
	else
		mostra_car(43);
}

void print_LEDs(unsigned char* pont) {
	unsigned char i=0;

	while(pont[i] != 0) {
		mostra_car2(pont[i]);
		i++;
		delay_ms(100);
	}
}


void desloca_texto(unsigned char* pont, unsigned int t) {
	unsigned int i;
	unsigned int j=8;

	for(i=0; pont[i] != 0; i++) {
        string[j]   = caract[pont[i]-48][0];
		string[j+1] = caract[pont[i]-48][1];
		string[j+2] = caract[pont[i]-48][2];
		string[j+3] = caract[pont[i]-48][3];
		string[j+4] = 0x00;
		j=j+5;
    }

	i=0;
	while (i < j) {
		delay_ms(t);
		P0 = string[i];
		P1 = string[i+1];
		P2 = string[i+2];
		P3 = string[i+3];
		SFRPAGE = CONFIG_PAGE;
		P4 = string[i+4];
		P5 = string[i+5];
		P6 = string[i+6];
		P7 = string[i+7];
		SFRPAGE = LEGACY_PAGE;
		i++;
	}
}

void main(void) {
	Init_Device();
	SFRPAGE = LEGACY_PAGE;

	desloca_texto("ISA:NERD", 150);
}
